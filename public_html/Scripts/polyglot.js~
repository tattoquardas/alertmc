var app = angular.module("testApp", []);
	app.controller("testController", function($scope, $http){
		$scope.hostURL = "http://localhost:3000/";
		$scope.testStarted = false;
		$scope.generateTest = function(){
			$scope.data = {
				"A" : [],
				"B" : [],
				"C" : [],
				"D" : [],
				"E" : []
			};
			$scope.headers = {
				"A" : "A. Which sentence has its words in the appropriate order?",
				"B" : "B. Which sentence has its words in the appropriate order?",
				"C" : "C. Which sentence has its words in the appropriate order?",
				"D" : "D. Which sentence has its words in the appropriate order?",
				"E" : "E. Which sentence has its words in the appropriate order?",
			}
			$scope.answers = {};
			$http.get($scope.hostURL + "getQuestionsForPoliglot?level=A&lang=eng").then(function(response){
				$scope.data["A"] = response.data;
				for(var i = 0; i<$scope.data["A"].length; ++i){
					$scope.data["A"][i].q_id = $scope.data["A"][i].q_id.split(" ").join("");
					$scope.answers[$scope.data["A"][i].q_id] = [];
					$http.get($scope.hostURL + "getAnswersForPoliglot?q_id=" + $scope.data["A"][i].q_id).then(
						function(response){
							if(response.data !== undefined && response.data.length>0){
								var q_id = response.data[0].q_id.split(" ").join("");
								$scope.answers[q_id] = response.data;
							}
						}
					);
				}
			});
			$http.get($scope.hostURL + "getQuestionsForPoliglot?level=B&lang=eng").then(function(response){
				$scope.data["B"] = response.data;
				for(var i = 0; i<$scope.data["B"].length; ++i){
					$scope.data["B"][i].q_id = $scope.data["B"][i].q_id.split(" ").join("");
					$scope.answers[$scope.data["B"][i].q_id] = [];
					$http.get($scope.hostURL + "getAnswersForPoliglot?q_id=" + $scope.data["B"][i].q_id).then(
						function(response){
							if(response.data !== undefined && response.data.length>0){
								var q_id = response.data[0].q_id.split(" ").join("");
								$scope.answers[q_id] = response.data;
							}
						}
					);
				}
			});
			$http.get($scope.hostURL + "getQuestionsForPoliglot?level=C&lang=eng").then(function(response){
				$scope.data["C"] = response.data;
				for(var i = 0; i<$scope.data["C"].length; ++i){
					$scope.data["C"][i].q_id = $scope.data["C"][i].q_id.split(" ").join("");
					$scope.answers[$scope.data["C"][i].q_id] = [];
					$http.get($scope.hostURL + "getAnswersForPoliglot?q_id=" + $scope.data["C"][i].q_id).then(
						function(response){
							if(response.data !== undefined && response.data.length>0){
								var q_id = response.data[0].q_id.split(" ").join("");
								$scope.answers[q_id] = response.data;
							}
						}
					);
				}
			});
			$http.get($scope.hostURL + "getQuestionsForPoliglot?level=D&lang=eng").then(function(response){
				$scope.data["D"] = response.data;
				for(var i = 0; i<$scope.data["D"].length; ++i){
					$scope.data["D"][i].q_id = $scope.data["D"][i].q_id.split(" ").join("");
					$scope.answers[$scope.data["D"][i].q_id] = [];
					$http.get($scope.hostURL + "getAnswersForPoliglot?q_id=" + $scope.data["D"][i].q_id).then(
						function(response){
							if(response.data !== undefined && response.data.length>0){
								var q_id = response.data[0].q_id.split(" ").join("");
								$scope.answers[q_id] = response.data;
							}
						}
					);
				}
			});
			$http.get($scope.hostURL + "getQuestionsForPoliglot?level=E&lang=eng").then(function(response){
				$scope.data["E"] = response.data;
				for(var i = 0; i<$scope.data["E"].length; ++i){
					$scope.data["E"][i].q_id = $scope.data["E"][i].q_id.split(" ").join("");
					$scope.answers[$scope.data["E"][i].q_id] = [];
					$http.get($scope.hostURL + "getAnswersForPoliglot?q_id=" + $scope.data["E"][i].q_id).then(
						function(response){
							if(response.data !== undefined && response.data.length>0){
								var q_id = response.data[0].q_id.split(" ").join("");
								$scope.answers[q_id] = response.data;
							}
						}
					);
				}
			});
		}
		$scope.generateTest();
		$scope.startTimer = function(duration, display) {
		    var timer = duration, minutes, seconds;
		    setInterval(function () {
			minutes = parseInt(timer / 60, 10);
			seconds = parseInt(timer % 60, 10);

			minutes = minutes < 10 ? "0" + minutes : minutes;
			seconds = seconds < 10 ? "0" + seconds : seconds;

			display.textContent = minutes + ":" + seconds;

			if (--timer < 0) {
			    clearInterval(this);
			    document.getElementById("test").innerHTML="GAME OVER";
			    document.getElementById("time").style.display="none";
			    document.getElementById("let").style.display="none";
			}
		    }, 1000);
		}
		$scope.timer = function(){
		    document.getElementById("comment_form").style.display="none";
		    document.getElementById("let").style.display="block";
		    var Minutes = 60,
		    display = document.querySelector('#time');
		    $scope.startTimer(Minutes, display);
		    A();
		}
		$(document).ready(
			function(){
				$("div.page-wrap > div#let > let").click(
					function(){
						activePic = $("div.page-wrap > div#let > let.active");
						$(activePic).removeClass("active");
						$(this).addClass("active");
					}
				);
				$("input#start").click(
					function(){
						setTimeout(function(){
							$scope.timer();
						}, 1000);
					}
				);
				$("#scrl1").click(
					function(){
						alert("A");
					}
				);
				$("#scrl2").click(
					function(){
						alert("B");
					}
				);
				$("#scrl3").click(
					function(){
						alert("C");
					}
				);
				$("#scrl4").click(
					function(){
						alert("D");
					}
				);
				$("#scrl5").click(
					function(){
						alert("E");
					}
				);
			}
		);
	});
